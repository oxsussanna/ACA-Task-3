

# 			Αρχιτεκτονική Υπολογιστών



### 							Χειμερινό εξάμηνο 2019/2020

### Τμήμα Ηλεκτρολόγων Μηχανικών και Μηχανικών Υπολογιστών

### 				Αριστοτέλειο Πανεπιστήμιο *Θεσσαλονίκης* 





### 							<u>3η Εργαστητριακή άσκηση</u>

#### Energy-Delay-Area Product Optimization (gem5+ McPAT)



##### Mόρσυ Χρήστος Αδάμ ΑΕΜ:8363

##### Πέννας Παναγιώτης Γεώργιος ΑΕΜ: 9016





Στο τρίτο μέρος της εργασίας χρησιμοποήσαμε το εργαλείο McPAT , ένα εργαλείο μοντελοποίησης αρχιτεκτονικής υπολογιστών που παράσχει εκτιμήσεις σχετικά με την κατανάλωση ισχύος, το μέγεθος ολοκλήρωσης και το χρονισμό τους.

#### <u>Μέρος</u> <u>1ο</u> :

##### Ερώτημα 1ο:

Για τη μοντελοποίηση και ανάλυση της ισχύος είναι απαραίτητη αρχικά η κατανόηση των 3 παραγόντων που την απαρτίζουν. Πιο συγκεκριμένα η συνολική ισχύς είναι το άθροισμα της dynamic και της leakage power:


$$
Total Power = Pdynamic+ Pleakage
$$


*Dynamic power* 

Θα μπορούσαμε να πούμε ότι η Dynamic Power είναι  με τη σειρά της το άθροισμα switching power και short-circuit power. Η  switching power είναι η ισχύς που καταναλώνεται για την φόρτιση και εκφόρτιση των πυκνωτών, ενώ short-circuit power είναι η ισχύς που απορροφάται σε βραχυκυκλώμα μεταξύ της τάσης τροφοδοσίας και της γείωσης κατά την εναλλαγή της κατάστασης διακοπτών.

Έτσι έχουμε:
$$
Dynamic Power = Pswitching + Pshort-circuit
$$




*Η Pswitching δίνεται απο τον τύπο:*


$$
Pswitching = a*f*Ceff*Vdd2
$$


όπου 

- a = συντελεστής δραστηριοότητας (switching activity factor)
- f = συνολική συχνότητα
- Ceff = συνολική συχνότητα 
- Vdd = τάση τροφοδοσίας



*Ενώ η Pshort-circuit  από τον τύπο:*
$$
Pshort-circuit = Isc*Vdd*f
$$
όπου 

- Isc =το ρεύμα βραχυκυκλώματος 
- Vdd = τάση τροφοδοσίας και 
-  f = συχνότητα μεταγωγής







*Leakage* *power*



Eίναι μια ανεπιθύμητη συμπεριφορά ενός τρανζίστορ, συνδέεται ιδιαίτερα με το ρεύμα που ρέει μέσω αυτών σε αδρανή κατάσταση και καθορίζεται από τα χαρακτηριστικά του τρανζίστορ:


$$
PLeakage = f (Vdd, Vth, W/L)
$$
όπου 

- Vdd = τάση τροφοδοσίας
-  Vth = τάση κατωφλίου
- W = πλάτος τρανζίστορ 
- L = μήκος τρανζίστορ





Από τις παραπάνω σχέσεις προκύπτει ότι:
$$
Total Power =Pswitching = a*f*Ceff*Vdd2+ Pshort-circuit = Isc*Vdd*f +PLeakage = f (Vdd, Vth, W/L)
$$




Η dynamic power είναι ανάλογη των switching activities της αρχιτεκτονικής σχεδιασμού η  οποία  επηρεάζεται από τον όγκο των δεδομένων που ο σχεδιασμός πρέπει να επεξεργαστεί σε δεδομένη μονάδα χρόνου μεταβάλλοντας τα τρανζίστορ μεταξύ των καταστάσεων ενεργοποίησης και απενεργοποίησης. Η μεταβολή αυτή της λογικής κατάστασης του συστήματος επηρεάζει με τη σειρά της τη στατική ισχύ που προκαλούν τα τρανζίστορ. Καταλήγουμε λοιπόν στο συμπέρασμα ότι το μέγεθος ενός προγράμματος, δηλαδή το πλήθος των  δεδομένων  που ένα σύστημα επεξεργάζεται επηρεάζει σημαντικά τόσο τη leakage ( ή αλλιώς static) όσο και τη  dynamic power. Σημειώνεται ότι για το ίδιο πρόγραμμα ο χρόνος εκτέλεσης επηρεάζει την ενέργεια που καταναλίσκεται αλλά όχι και την ισχύ του συστήματος.



##### Ερώτημα 2ο:

Ο παράγοντας που λαμβάνουμε υπόψιν για να συγκρίνουμε τη διάρκεια μπαταρίας δυο συστημάτων είναι η ενέργεια που το κάθε σύστημα καταναλώνει. Εδώ εισάγεται και η έννοια του energy effeciency. Συγκρίνοντας την ενεργειακή αποδοτικότητα των συστημάτων και εφόσον γνωρίζουμε την κατανάλωση ισχύος και των 2 καταλήγουμε στον ορισμό της ισχύος. Δηλαδή η ισχύς που καταναλώνει ένα σύστημα είναι ανάλογη της ενέργειας και αντιστρόφως ανάλογη του χρόνου. Έτσι παρότι το πρώτο σύστημα έχει 8 φορές μικρότερη κατανάλωση απο το 2ο, αρκεί ο χρόνος εκτέλεσης του δεύτερου να είναι 8 φορές μικρότερος από του πρώτου για να είναι ενεργεικά αποδοτικότερος και άρα να έχει μεγαλύτερη διάρκεια μπαταρίας. Το McPAT δε μας δίνει πληροφορία για το χρόνο εκτέλεσης και άρα δεν μπορεί να μας δώσει απάντηση στο συγκεκριμένο ερώτημα. Για να γίνει αυτό μπορούμε να χρησιμοποιήσουμε τα αποτελέσματα του Gem5 για τους χρόνους εκτέλεσης των συστημάτων.



##### Ερώτημα 3ο:



|                          | ARM A9 | Xeon   |
| ------------------------ | ------ | ------ |
| Area  (mm^2)             | 5.39   | 410.5  |
| Peak Power (W)           | 1.74   | 134.93 |
| Total Leakage (W)        | 0.1    | 36.83  |
| Subthreshold Leakage (W) | 0.05   | 35.16  |
| Gate Leakage (W)         | 0.05   | 1.66   |
| Runtime Dynamic (W)      | 2.96   | 72.91  |





Εφόσον τρέξαμε τις δύο προσομοιώσεις για τους επεξεργαστές Xeon και ΑRM και λαμβάνοντας υπόψιν την υπόθεση που μας δόθηκε καταλήγουμε στο συμπέρασμα ότι μετά την εκτέλεση του προγράμματος το σύστημα παραμένει ανοιχτό και άρα το leakage power θα αυξάνεται  για μεγάλο χρόνο εκτέλεσης.Καθώς o Χeon έχει πολύ μεγάλο leakage σε σχέση με τον ARM αυτός είναι και ο λόγος για τον οποίο ο πρώτος δεν μπορεί να είναι ενεργεικά αποδοτικότερος.



#### <u>Μέρος</u> <u>2ο</u> :

##### Ερώτημα 1ο:

Στο 2ο μέρος θα χρησιμοποιήσουμε τη μέτρηση Energy-Delay-Area-Product (EDAP),το οποίο συνδυάζει την απόδοση τόσο με το power όσο και με τo area. Αυτή η μέτρηση είναι χρήσιμη για να ποσοτικοποιήσει το κόστος των νέων αρχιτεκτονικών ιδεών και να αξιολογήσει τους συνδυασμούς διαφορετικών αρχιτεκτονικών. 



Για να αξιοποιήσουμε αυτα τα στοιχεία πρέπει να ανατρέξουμε:



- Delay : Aυτή η τιμή μπορεί να εξαχθεί από sim_seconds, ένα στατιστικό στοιχείο προσομοίωσης από την έξοδο Gem5.
- Energy : Για να αποκτήσουμε αυτή την τιμή, πρέπει πρώτα να εξαγάγουμε RuntimeDynamic, Subthreshold Leakage και Gate Leakage, από τις κατηγορίες core και L2 και αθροίζοντας τα αντίστοιχα στοιχεία από τις 2 κατηγορίες πολλαπλασιάζουμε το αποτέλεσμα που βρήκαμε με το sim_seconds. 
- Area : Η τιμή αυτή βρίσκεται στα στατιστικά στοιχεία στην έξοδο McPAT. Αθροίζουμε τα area από το core και το L2 για να πάρουμε τα επιθυμητά αποτελέσματα.





Παρακάτω παραδίδουμε το EDAP για τα benchmarks μεταβάλλοντας κάθε φορά μία από τις παραμέτρους:

![L1d_size](https://github.com/oxsussanna/ACA-Task-3/blob/master/Bars%20and%20Charts/EDAP/L1dsize.png)

| **EDAP/L1d_size** | 16       | 32       | 64       | 128      |
| ----------------- | -------- | -------- | -------- | -------- |
| **bzip**          | 0.264706 | 0.257656 | 0.535262 | 0.775676 |
| **mcf**           | 0.116264 | 0.117279 | 0.248815 | 0.371616 |
| **libm**          | 0.620943 | 0.631213 | 1.300720 | 1.943418 |
| **sjeng**         | 4.625925 | 4.635467 | 4.732145 | 5.845645 |
| **hmmer**         | 0.134371 | 0.137747 | 0.118453 | 0.445031 |



| **EDAP/L1d_assoc** | 2         | 4         | 8        | 16        |
| ------------------ | --------- | --------- | -------- | --------- |
| **bzip**           | 0.775676  | 0.712698  | 0.535710 | 0.653566  |
| **mcf**            | 0.371616  | 0.344635  | 0.262102 | 0.332101  |
| **libm**           | 0.608053  | 0.792648  | 0.936181 | 1.275458  |
| **sjeng**          | 13.384244 | 12.044533 | 8.712268 | 11.071950 |
| **hmmer**          | 0.445031  | 0.414581  | 0.316494 | 0.118196  |



| **EDAP/L1i_size** | 16        | 32        | 64        | 128       |
| ----------------- | --------- | --------- | --------- | --------- |
| **bzip**          | 0.648403  | 0.653566  | 0.932365  | 1.200771  |
| **mcf**           | 0.539656  | 0.332101  | 0.469191  | 0.601212  |
| **libm**          | 0.612234  | 0.620943  | 1.138040  | 1.656519  |
| **sjeng**         | 11.943750 | 12.044533 | 17.738156 | 23.066181 |
| **hmmer**         | 0.314479  | 0.316494  | 0.464397  | 0.607767  |



| **EDAP/L1i_assoc** | 2         | 4         | 8         | 16        |
| ------------------ | --------- | --------- | --------- | --------- |
| **bzip**           | 0.648403  | 0.709666  | 0.755182  | 0.843716  |
| **mcf**            | 0.469191  | 0.387174  | 0.397587  | 0.448127  |
| **libm**           | 0.612234  | 0.714285  | 0.788861  | 1.002642  |
| **sjeng**          | 23.066181 | 20.941490 | 16.251469 | 17.217241 |
| **hmmer**          | 0.607706  | 0.566261  | 0.434398  | 0.461669  |



| **EDAP/L2_size** | 1         | 2        | 4         |
| ---------------- | --------- | -------- | --------- |
| **bzip**         | 0.536233  | 0.648403 | 0.907199  |
| **mcf**          | 0.322315  | 0.387174 | 0.534527  |
| **libm**         | 0.459296  | 0.612234 | 0.958132  |
| **sjeng**        | 14.920856 | 17.21724 | 22.350830 |
| **hmmer**        | 0.363134  | 0.434398 | 0.593721  |





| **EDAP/L2_assoc** | 2         | 4         | 8         | 16        |
| ----------------- | --------- | --------- | --------- | --------- |
| **bzip**          | 0.889613  | 0.900782  | 0.907199  | 0.899907  |
| **mcf**           | 0.524140  | 0.530850  | 0.534527  | 0.530646  |
| **libm**          | 0.935111  | 0.949106  | 0.958132  | 0.949494  |
| **sjeng**         | 21.980169 | 22.235434 | 22.350830 | 22.221432 |
| **hmmer**         | 0.363260  | 0.363196  | 0.363134  | 0.364593  |



| **EDAP/cache_line** | 32        | 64        | 128       |
| ------------------- | --------- | --------- | --------- |
| **bzip**            | 0.854742  | 0.899907  | 3.124415  |
| **mcf**             | 0.481739  | 0.532877  | 1.556026  |
| **libm**            | 1.727310  | 0.932387  | 1.521579  |
| **sjeng**           | 46.914153 | 21.980169 | 23.641424 |
| **hmmer**           | 0.299470  | 0.363260  | 1.363836  |



##### Ερώτημα 2ο:

Παρακάτω παραθέτουμε πίνακες και διαγράμματα που δείχνουν πόσο τα στοιχεία L2_size, L2_assoc και cacheline_size επηρρεάζουν το Area και το Peak Dynamic:

| Area/L2_size | 1        | 2        | 4        |
| ------------ | -------- | -------- | -------- |
| bzip         | 12.5081  | 15.34609 | 21.66469 |
| mcf          | 16.75898 | 16.75898 | 23.07758 |
| libm         | 8.64556  | 11.48356 | 17.80216 |
| sjeng        | 18.6214  | 21.4594  | 27.778   |
| hmmer        | 14.5738  | 17.4118  | 23.7304  |



| Peak Dynamic/L2_size | 1       | 2       | 4       |
| -------------------- | ------- | ------- | ------- |
| bzip                 | 3.56229 | 3.66629 | 3.78649 |
| mcf                  | 4.14028 | 4.24428 | 4.36448 |
| libm                 | 2.11144 | 2.21544 | 2.33564 |
| sjeng                | 4.27677 | 4.38076 | 4.50096 |
| hmmer                | 4.16356 | 4.26756 | 4.38776 |



| Area/L2_assoc | 2        | 4        | 8        | 16       |
| ------------- | -------- | -------- | -------- | -------- |
| bzip          | 21.21969 | 21.50819 | 21.66469 | 21.49549 |
| mcf           | 22.63258 | 22.92108 | 23.07758 | 22.90838 |
| libm          | 17.35716 | 17.4566  | 17.80216 | 17.63296 |
| sjeng         | 27.333   | 27.6215  | 27.778   | 27.6088  |
| hmmer         | 14.57919 | 14.57652 | 14.5738  | 14.631   |





| Peak Dynamic/L2_assoc | 2       | 4       | 8       | 16      |
| --------------------- | ------- | ------- | ------- | ------- |
| bzip                  | 3.78389 | 3.7854  | 3.78649 | 3.78827 |
| mcf                   | 4.36188 | 4.36339 | 4.36448 | 4.36626 |
| libm                  | 2.33304 | 2.33455 | 2.33564 | 2.33742 |
| sjeng                 | 4.49836 | 4.49987 | 4.50096 | 4.50274 |
| hmmer                 | 4.16224 | 4.16267 | 4.16356 | 4.16524 |







| Area/cacheline_size | 32       | 64       | 128      |
| ------------------- | -------- | -------- | -------- |
| bzip                | 25.8428  | 21.49549 | 37.8474  |
| mcf                 | 26.9951  | 23.07758 | 37.849   |
| libm                | 16.86741 | 17.35716 | 27.73839 |
| sjeng               | 27.2331  | 27.333   | 40.6326  |
| hmmer               | 14.41278 | 14.57919 | 35.9756  |





| Peak Dynamic/cacheline_size | 32      | 64      | 128     |
| --------------------------- | ------- | ------- | ------- |
| bzip                        | 1.75402 | 3.78827 | 10.1982 |
| mcf                         | 1.98195 | 4.36448 | 10.7713 |
| libm                        | 1.25176 | 2.33304 | 6.86393 |
| sjeng                       | 2.1024  | 4.49836 | 11.9297 |
| hmmer                       | 1.85753 | 4.16224 | 10.263  |





##### Ερώτημα 3ο:

Εφόσον πραγματοποιήσαμε τα διαγράμματα και τους πίνακες για να δείξουμε τον τρόπο που επιδρά η μεταβολή κάθε παραμέτρου (cache line size,associativity και size της L2) στα Area και Peak Dynamic, είμαστε σε θέση να πούμε ότι η αύξηση του assoc δεν επηρεάζει σχεδόν καθόλου τις 2 παραμέτρους σε αντίθεση με τα cache line size και L2_size. Μάλιστα στην πρώτη περίπτωση έχουμε εντυπωσική αύξηση για ανάλογη αύξηση των παραμέτρων. Καταλαβαίνουμε λοιπόν ότι σε σχέση με το κόστος, που είχαμε αύξηση του και την αντίστοιχη αύξηση της κάθε παραμέτρου δε συμβαίνει το ίδιο και με τον παράγοντα της ισχύος.



#### Εργαστήριο 3ο(κριτική):

Η προσθήκη της ισχύος ως παράμετρο στη μελέτη της αρχιτεκτονικής ενός συστήματος μας έδωσε να καταλάβουμε τη σημαντικότητα της εξοικονόμησης ενέργειας στο σχεδιασμό. Μέσω του εργαστηρίου είχαμε τη δυνατότητα να εξάγουμε και να αναλύσουμε δεδομένα από το McPAT και συνδυάζοντας τα με τα αντίστοιχα του gem5 να εξάγουμε σημαντικά πορίσματα. Αξίζει να σημειώσουμε ότι τα προγράμματα έτρεξαν σε μικρούς χρόνους κάτι που έκανε το έργο μας πιο εύκολο σε σχέση με το προηγούμενο εργαστήριο. Τέλος ήρθαμε σε επαφή με καινούργιες έννοιες μελέτης της ισχύος που συνδένται με παρμέτρους επιπέδου μικροηλεκτρνικής και πυλών λογικής σχεδίασης. Γενικά για το εργαστηριο 

Το εργαστήριο αυτό μας έφερε σε μια πρώτη επαφή με το αντικείμενο του αρχιτέκτονα συστημάτων. Κατανοήσαμε την ισσοροπία που πρέπει να υπάρχει μεταξύ αποδοτικότητας, κόστους και εξοικονόμηση ενέργειας αλλά και καινούργιων για εμάς εννοιών που σχετίζονται με τους βασικούς αυτούς παράγοντες. Μέσω του εργαστηρίου μάθαμε να χειριζόμαστε τόσο σημαντικά εργαλεία αρχιτεκτονικής υπολογιστών (ΜcPAT,gem5) όσο και λειτουργικού συστήματος (Ubuntu) αλλά και προγραμμάτων όπως το Typora για αναφορές. Πρόκειται για ένα αρκετά πρακτικό εργαστήριο αν και θα προτιμούσαμε ίσως μία πιο ενισχυμένη καθοδήγηση για τις μεθόδους που πρέπει να ακολουθήσουμε όπως για παράδειγμα στην περίπτωση εύρεσης καλύτερου CPI.

